---
import "../styles/global.css";
import CookieConsent from "../components/CookieConsent.astro";
import { SEO } from "astro-seo";

interface Props {
	title?: string;
	description?: string;
	image?: string;
	canonical?: string;
}

const {
	title = "Parth Sinha - Full Stack Developer | Portfolio 2025",
	description = "Full Stack Developer passionate about creating elegant solutions. Experienced in JavaScript, TypeScript, React, Node.js, Python, AWS, Docker, and modern web technologies. Explore my projects and blog posts on software development.",
	image = "/images/Holi%20Joy_%20A%20Vibrant%20Portrait%20of%20Celebration.png",
	canonical = Astro.url.pathname,
} = Astro.props;

const baseUrl = Astro.site || new URL(Astro.url.origin);
// Remove trailing slash from canonical path (except for root "/")
const cleanCanonical = canonical === '/' ? canonical : canonical.replace(/\/$/, '');
const canonicalURL = new URL(cleanCanonical, baseUrl);
const imageUrl = new URL(image, baseUrl);

const structuredData = {
	"@context": "https://schema.org",
	"@type": "Person",
	"name": "Parth Sinha",
	"url": baseUrl.href,
	"image": imageUrl.href,
	"sameAs": [
		"https://github.com/sinhaparth5",
		"https://www.linkedin.com/in/parth-sinha18",
		"https://x.com/sinhaparth555",
		"https://parth-sinha.medium.com"
	],
	"jobTitle": "Full Stack Developer",
	"worksFor": {
		"@type": "Organization",
		"name": "Freelance"
	},
	"description": description,
	"email": "sinhaparth555@gmail.com",
	"knowsAbout": [
		"JavaScript",
		"TypeScript",
		"React",
		"Node.js",
		"Python",
		"AWS",
		"Docker",
		"MongoDB",
		"Next.js",
		"Tailwind CSS",
		"GraphQL",
		"PostgreSQL"
	]
};
---

<!doctype html>
<html lang="en">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<SEO
			charset="UTF-8"
			title={title}
			description={description}
			canonical={canonicalURL.href}
			noindex={false}
			nofollow={false}
			openGraph={{
				basic: {
					title: title,
					type: "website",
					image: imageUrl.href,
					url: canonicalURL.href
				},
				optional: {
					description: description,
					siteName: "Parth Sinha Portfolio",
					locale: "en_US"
				},
				image: {
					alt: "Parth Sinha - Full Stack Developer Portfolio",
					width: 1200,
					height: 630
				}
			}}
			twitter={{
				card: "summary_large_image",
				site: "@sinhaparth555",
				creator: "@sinhaparth555",
				title: title,
				description: description,
				image: imageUrl.href,
				imageAlt: "Parth Sinha - Full Stack Developer Portfolio"
			}}
			extend={{
				meta: [
					{ name: "author", content: "Parth Sinha" },
					{ name: "keywords", content: "Parth Sinha, Full Stack Developer, Web Developer, JavaScript, TypeScript, React, Node.js, Python, AWS, Docker, MongoDB, Portfolio, Software Engineer, Frontend Developer, Backend Developer" },
					{ name: "language", content: "English" },
					{ name: "revisit-after", content: "7 days" },
					{ name: "google-adsense-account", content: "ca-pub-1491419950635233" },
					{ name: "theme-color", content: "#1A1A1A" },
					{ name: "msapplication-TileColor", content: "#1A1A1A" },
					{ name: "mobile-web-app-capable", content: "yes" },
					{ name: "apple-mobile-web-app-capable", content: "yes" },
					{ name: "apple-mobile-web-app-status-bar-style", content: "black-translucent" }
				],
				link: []
			}}
		/>

		<link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
		<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2" />
		<link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico" />
		<link rel="manifest" href="/manifest.json" />

		<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
		<link rel="dns-prefetch" href="https://fonts.googleapis.com" />
		<link rel="dns-prefetch" href="https://fonts.gstatic.com" />
		<link rel="dns-prefetch" href="https://api.github.com" />
		<link rel="dns-prefetch" href="https://medium.com" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'" />
		<noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" /></noscript>
	</head>
	<body>
		<a href="#main-content" class="skip-link">Skip to main content</a>

		<div id="scroll-progress" class="fixed top-0 left-0 h-1 bg-gradient-to-r from-[var(--accent)] via-[var(--foreground)] to-[var(--accent)] z-50 transition-all duration-300" style="width: 0%" role="progressbar" aria-label="Page scroll progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>

		<button
			id="back-to-top"
			class="fixed bottom-8 right-8 w-12 h-12 bg-[var(--foreground)] text-[var(--background)] rounded-full shadow-2xl opacity-0 pointer-events-none transition-all duration-300 hover:scale-110 hover:shadow-[0_0_30px_rgba(0,0,0,0.3)] z-40 flex items-center justify-center"
			aria-label="Back to top"
		>
			<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
			</svg>
		</button>

		<main id="main-content">
			<slot />
		</main>

		<CookieConsent />

		<!-- Google Analytics - Deferred for performance -->
		<script>
		window.addEventListener('load', function() {
			var gaScript = document.createElement('script');
			gaScript.async = true;
			gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-0P5Z6LMTGX';
			document.head.appendChild(gaScript);

			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-0P5Z6LMTGX');
		});
		</script>

		<script>
			if ('loading' in HTMLImageElement.prototype) {
				document.querySelectorAll('img:not([loading])').forEach(img => {
					img.loading = 'lazy';
				});
			}

			const links = document.querySelectorAll('a[href^="/"]');
			links.forEach(link => {
				link.addEventListener('mouseenter', () => {
					const url = link.getAttribute('href');
					if (url && !document.querySelector(`link[rel="prefetch"][href="${url}"]`)) {
						const prefetch = document.createElement('link');
						prefetch.rel = 'prefetch';
						prefetch.href = url;
						document.head.appendChild(prefetch);
					}
				}, { once: true });
			});

			const scrollProgress = document.getElementById('scroll-progress');
			const updateScrollProgress = () => {
				const windowHeight = window.innerHeight;
				const documentHeight = document.documentElement.scrollHeight;
				const scrollTop = window.scrollY;
				const scrollPercent = (scrollTop / (documentHeight - windowHeight)) * 100;
				const progress = Math.min(scrollPercent, 100);
				scrollProgress.style.width = `${progress}%`;
				scrollProgress.setAttribute('aria-valuenow', Math.round(progress).toString());
			};

			window.addEventListener('scroll', updateScrollProgress, { passive: true });
			updateScrollProgress();

			const backToTop = document.getElementById('back-to-top');
			const toggleBackToTop = () => {
				if (window.scrollY > 300) {
					backToTop.classList.remove('opacity-0', 'pointer-events-none');
					backToTop.classList.add('opacity-100', 'pointer-events-auto');
				} else {
					backToTop.classList.add('opacity-0', 'pointer-events-none');
					backToTop.classList.remove('opacity-100', 'pointer-events-auto');
				}
			};

			window.addEventListener('scroll', toggleBackToTop, { passive: true });

			backToTop.addEventListener('click', () => {
				window.scrollTo({ top: 0, behavior: 'smooth' });
			});
		</script>
	</body>
</html>

<style>
	html {
		height: 100%;
	}

	body {
		margin: 0;
		width: 100%;
		min-height: 100%;
		position: relative;
	}
</style>
